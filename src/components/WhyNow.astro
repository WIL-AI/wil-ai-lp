---
import de from '../i18n/de.json';
import en from '../i18n/en.json';
---

<section id="whyNow" class="relative py-24 md:py-32">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-16 reveal">
      <span class="inline-block px-4 py-1.5 rounded-full text-xs font-semibold tracking-wider uppercase border border-primary-500/30 text-primary-400 mb-4">
        <span data-lang-de>{de.whyNow.sectionLabel}</span>
        <span data-lang-en class="hidden">{en.whyNow.sectionLabel}</span>
      </span>
      <h2 class="section-title text-3xl sm:text-4xl md:text-5xl mb-4">
        <span data-lang-de>{de.whyNow.title}</span>
        <span data-lang-en class="hidden">{en.whyNow.title}</span>
      </h2>
      <p class="section-subtitle text-lg md:text-xl max-w-3xl mx-auto">
        <span data-lang-de>{de.whyNow.subtitle}</span>
        <span data-lang-en class="hidden">{en.whyNow.subtitle}</span>
      </p>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {de.whyNow.stats.map((stat, i) => (
        <div class="glass-card stat-card p-8 text-center reveal" style={`transition-delay: ${i * 100}ms`}>
          <div class="text-4xl md:text-5xl font-extrabold gradient-text mb-2 counter-value"
               data-target={stat.value}
               data-suffix-de={stat.suffix}
               data-suffix-en={en.whyNow.stats[i].suffix}>
            0{stat.suffix}
          </div>
          <p class="stat-label text-dark-400 text-sm leading-relaxed mt-3">
            <span data-lang-de>{stat.label}</span>
            <span data-lang-en class="hidden">{en.whyNow.stats[i].label}</span>
          </p>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  // ── Animated counters ──
  const counterObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const el = entry.target as HTMLElement;
          const target = parseFloat(el.dataset.target || '0');
          const suffixDe = el.dataset.suffixDe || '';
          const suffixEn = el.dataset.suffixEn || '';
          const isDecimal = target % 1 !== 0;
          const duration = 2000;
          const startTime = performance.now();

          function update(currentTime: number) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            // Ease out cubic
            const eased = 1 - Math.pow(1 - progress, 3);
            const current = eased * target;

            const lang = document.documentElement.getAttribute('data-lang') || 'de';
            const suffix = lang === 'en' ? suffixEn : suffixDe;

            if (isDecimal) {
              el.textContent = current.toFixed(1) + suffix;
            } else {
              el.textContent = Math.floor(current) + suffix;
            }

            if (progress < 1) {
              requestAnimationFrame(update);
            }
          }
          requestAnimationFrame(update);
          counterObserver.unobserve(el);
        }
      });
    },
    { threshold: 0.5 }
  );

  document.querySelectorAll('.counter-value').forEach(el => counterObserver.observe(el));
</script>
